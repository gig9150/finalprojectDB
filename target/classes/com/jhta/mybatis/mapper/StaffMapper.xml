<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jhta.mybatis.mapper.staff">
	<select id="getinfo" parameterType="int" resultType="staff">
		select * from staff where staffNum=#{staffNum}
	</select>
	
	<sql id="sfinfo">
		<if test="br!=null and br!=''">
			and b.brName in
			<foreach collection="br" item="item" separator="," open="(" close=")">
				 #{item}
			</foreach>
		</if>
		<if test="sf!=null and sf!=''">
			and sf.sffPosition in
			<foreach collection="sf" item="item" separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="di!=null and di!=''">
			and d.divisionName in
			<foreach collection="di" item="item" separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
	</sql>
	
	<resultMap type="hashMap" id="getResultMap">
		<id property="num" column="staffNum"/>
		<id property="name" column="sffName"/>
		<id property="age" column="sffAge"/>
		<id property="addr" column="sffAddr"/>
		<id property="gender" column="gender"/>
		<id property="status" column="sffStatus"/>
		<id property="account" column="accountNum"/>
		<id property="brName" column="brName"/>
		<id property="position" column="sffPosition"/>
		<id property="division" column="divisionName"/>
		<id property="brNum" column="branchNum"/>
	</resultMap>
	
	<select id="staffList" resultMap="getResultMap" parameterType="hashMap">
		select * from
			(
			select aa.*,rownum rnum from 
				(
					select s.staffNum,s.sffName,s.sffAge,s.sffAddr,s.gender,b.brName,
					s.sffStatus,sf.sffPosition,d.divisionName,s.accountNum,b.branchNum
					from staff s,staffType sf,division d,branch b 
					where b.branchNum=s.branchNum and s.sffNum=sf.sffNum 
					and d.divisionNum=s.divisionNum <include refid="sfinfo"></include> 
					order by b.brName,sf.sffNum
				) aa
			)
		<![CDATA[where rnum>=#{startRow} and rnum<=#{endRow}]]>
	</select>
	
	<select id="getCount" parameterType="hashMap" resultType="int">
		select NVL(count(*),0) from staff s,staffType sf,division d,branch b 
		where b.branchNum=s.branchNum and s.sffNum=sf.sffNum and d.divisionNum=s.divisionNum 
		<include refid="sfinfo"></include>
	</select>
	
	<select id="getBrName" resultType="string">
		select brName from branch order by branchNum asc
	</select>
	
	<select id="getSffPosition" resultType="stafftype">
		select * from staffType order by sffNum asc
	</select>
	
	<select id="getDivisionName" resultType="division">
		select * from division order by divisionNum asc
	</select>
	
	<insert id="staffInsert" parameterType="staff">
		insert into staff
		values(staffNum.nextval,#{sffNum},#{divisionNum},#{sffName},#{sffAge},#{sffAddr},#{jumin},#{gender},#{accountNum},#{sffStatus},#{branchNum})
	</insert>
	
	<update id="staffUpdate" parameterType="staff">
		update staff set sffAddr=#{sffAddr},
		accountNum=#{accountNum},
		sffStatus=#{sffStatus},
		divisionNum=#{divisionNum},sffNum=#{sffNum}
		where staffNum=#{staffNum}
	</update>
	
</mapper>