<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jhta.mybatis.mapper.staff">
	<select id="getinfo" parameterType="int" resultType="staff">
		select * from staff where staffNum=#{staffNum}
	</select>
	<sql id="sfinfo">
		<where>
			and b.branchNum=s.branchNum and s.sffNum=sf.sffNum 
			and d.divisionNum=s.divisionNum
			<if test="br!=null and br!=''">
				and b.brName in
				<foreach collection="br" item="item" separator="," open="(" close=")">
					 #{item}
				</foreach>
			</if>
			<if test="sf!=null and sf!=''">
				and sf.sffPosition in
				<foreach collection="sf" item="item" separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="di!=null and di!=''">
				and d.divisionName in
				<foreach collection="di" item="item" separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
		</where>
	</sql>
	<resultMap type="hashMap" id="getResultMap">
		<id property="name" column="sffName"/>
		<id property="age" column="sffAge"/>
		<id property="addr" column="sffAddr"/>
		<id property="gender" column="gender"/>
		<id property="status" column="sffStatus"/>
		<id property="position" column="sffPosition"/>
		<id property="division" column="divisionName"/>
	</resultMap>
	
	<select id="staffList" resultMap="getResultMap" parameterType="hashMap">
		select * from
			(
			select aa.*,rownum rnum from 
				(
					select s.sffName,s.sffAge,s.sffAddr,s.gender,s.sffStatus,sf.sffPosition,d.divisionName from staff s,staffType sf,division d,branch b <include refid="sfinfo"></include>
				) aa
			)
		<![CDATA[where rnum>=#{startRow} and rnum<=#{endRow}]]>
	</select>
	
	<select id="getCount" parameterType="hashMap" resultType="int">
		select NVL(count(*),0) from staff s,staffType sf,division d,branch b  
		<include refid="sfinfo"></include>
	</select>
	
	<select id="getBrName" resultType="string">
		select brName from branch
	</select>
	<select id="getSffPosition" resultType="string">
		select sffPosition from staffType
	</select>
	<select id="getDivisionName" resultType="string">
		select divisionName from division
	</select>
</mapper>